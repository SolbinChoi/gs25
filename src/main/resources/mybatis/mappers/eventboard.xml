<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="eventboard">

	<select id="getCal" resultType="java.lang.Integer">
	<![CDATA[
	select count(*) from event
	]]>
	</select>
	
	<select id="getList" parameterType="map" resultType="eventboardvo">
	<choose>
	 <when test="#{keyword==''}">
	<![CDATA[
	select * from
	(select a.*, rownum rn from
	(select a.no, a.title, b.imageurl, 
	to_char(a.startdate, 'yyyy-mm-dd') as startdate, 
	to_char(a.enddate, 'yyyy-mm-dd') as enddate,
	a.count, a.user_no
	from event a, eventfile b where a.no=b.no order by no desc) a)
	where #{page_top}<=rn and rn<=#{page_bottom}
	]]>
	</when>
	<otherwise>
	<![CDATA[
	sselect * from
	(select a.*, rownum rn from
	(select a.no, a.title, b.imageurl, 
	to_char(a.startdate, 'yyyy-mm-dd') as startdate, 
	to_char(a.enddate, 'yyyy-mm-dd') as enddate,
	a.count, a.user_no
	from event a, eventfile b where a.no=b.no and title like #{keyword} order by no desc) a)
	where #{page_top}<=rn and rn<=#{page_bottom}
	]]>
	</otherwise>
	</choose>
	</select>
	
	<select id="selectBoard" parameterType="java.lang.Long" resultType="eventboardvo">
	<![CDATA[
	select no, title,startdate, enddate, store_no, user_no 
	from event where no=#{no}
	]]>
	</select>
	
	<update id="updateCount" parameterType="java.lang.Long">
	<![CDATA[
	update event set count = count + 1 where no =#{no}
	]]>
	</update>
	
	<delete id="delete" parameterType="java.lang.Long">
	<![CDATA[
	delete from event where no=#{no}
	]]>
	</delete>
	
	<insert id="insert" parameterType="eventboardvo">
	<selectKey resultType="java.lang.Long" keyProperty="no" order="BEFORE">
		<![CDATA[
			select seq_event.nextVal as no FROM DUAL
		]]>
	</selectKey>
	<![CDATA[
	INSERT INTO event(
	no, title, STARTDATE, ENDDATE,count,store_no,user_no
	) 
	values(
		#{no},
		#{title},
		#{startdate},
		#{enddate},
		0,
		4,
		#{UserNo}
		)
	]]>
	</insert>
	
	<insert id="insertAttachEvFile" parameterType="kr.ac.sungkyul.gs25.vo.AttachFileEvVO">
	<![CDATA[
	insert into eventfile( 
		fNO, no, path, orgName, saveName, fileSize, imageurl
	) 
	values(
		seq_eventfile.nextVal, #{no}, #{path}, #{orgName}, #{saveName},#{fileSize} ,#{imageurl}
	)
	]]>
	</insert>
</mapper>
	